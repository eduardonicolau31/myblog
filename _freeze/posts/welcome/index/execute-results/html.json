{
  "hash": "da1680ef655146f682935ece11e8fbe7",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"Monitoramento da frota de ônibus\"\nFormat: html\nauthor: \"Eduardo Nicolau Martins\"\ndate: \"2025-11-20\"\nimage: \"mapa.png\"\ncategories: [API, Monitoramento, Ônibus, Python]\n---\n\nNeste post, vamos visualizar as paradas e a posição em tempo real dos ônibus da linha **8200-10 (Terminal Lapa - Terminal Pirituba)** utilizando a API Olho Vivo da SPTrans e a biblioteca Folium.\n\nOs **pins azuis** representam as paradas oficiais da linha, e os **ícones vermelhos de ônibus** representam a localização exata dos veículos no momento em que este código foi executado.\n\n::: {#9ef7009e .cell execution_count=1}\n``` {.python .cell-code}\nimport requests\nimport folium\nfrom IPython.display import display\n\nTOKEN = \"edc09af1758e3c9c2f062f80f3131da78d17ad4651f071c2b68ab7b426fe26d6\"\nLINHA_DESEJADA = \"8200-10\"\n\nBASE_URL = \"http://api.olhovivo.sptrans.com.br/v2.1\"\nsession = requests.Session()\n\ndef autenticar():\n    response = session.post(f\"{BASE_URL}/Login/Autenticar?token={TOKEN}\")\n    return response.text == \"true\"\n\ndef obter_dados_inteligente(termo):\n    response = session.get(f\"{BASE_URL}/Linha/Buscar?termosBusca={termo}\")\n    linhas = response.json()\n    if not linhas:\n        return [], None\n    for info in linhas:\n        codigo = info['cl']\n        resp_paradas = session.get(f\"{BASE_URL}/Parada/BuscarParadasPorLinha?codigoLinha={codigo}\")\n        lista_paradas = resp_paradas.json()\n        if len(lista_paradas) > 0:\n            return lista_paradas, codigo\n    return [], None\n\ndef obter_posicoes(codigo_linha):\n    if codigo_linha is None:\n        return []\n    response = session.get(f\"{BASE_URL}/Posicao/Linha?codigoLinha={codigo_linha}\")\n    dados = response.json()\n    return dados['vs']\n\n\nif autenticar():\n    print(\"Autenticado! Buscando dados...\")\n    paradas, codigo_linha = obter_dados_inteligente(LINHA_DESEJADA)\n    \n    if codigo_linha:\n        onibus_agora = obter_posicoes(codigo_linha)\n    else:\n        onibus_agora = []\n        \n    print(f\"Resumo: {len(paradas)} paradas e {len(onibus_agora)} ônibus.\")\n    \n\n    lat_mapa, lon_mapa = -23.5505, -46.6333\n    if len(paradas) > 0:\n        lat_mapa, lon_mapa = paradas[0]['py'], paradas[0]['px']\n    elif len(onibus_agora) > 0:\n        lat_mapa, lon_mapa = onibus_agora[0]['py'], onibus_agora[0]['px']\n    \n\n    mapa = folium.Map(location=[lat_mapa, lon_mapa], zoom_start=13)\n    \n    for p in paradas:\n        folium.Marker(\n            [p['py'], p['px']],\n            popup=f\"Parada: {p['np']}\",\n            icon=folium.Icon(color=\"blue\", icon=\"info-sign\")\n        ).add_to(mapa)\n        \n    for bus in onibus_agora:\n        folium.Marker(\n            [bus['py'], bus['px']],\n            popup=f\"Prefixo: {bus['p']}\",\n            icon=folium.Icon(color=\"red\", icon=\"bus\", prefix=\"fa\")\n        ).add_to(mapa)\n    \n    display(mapa)\n\nelse:\n    print(\"Erro na autenticação. Verifique o Token.\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAutenticado! Buscando dados...\nResumo: 5 paradas e 1 ônibus.\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```{=html}\n<div style=\"width:100%;\"><div style=\"position:relative;width:100%;height:0;padding-bottom:60%;\"><span style=\"color:#565656\">Make this Notebook Trusted to load map: File -> Trust Notebook</span><iframe srcdoc=\"&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    \n    &lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=UTF-8&quot; /&gt;\n    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.js&quot;&gt;&lt;/script&gt;\n    &lt;script src=&quot;https://code.jquery.com/jquery-3.7.1.min.js&quot;&gt;&lt;/script&gt;\n    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js&quot;&gt;&lt;/script&gt;\n    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.js&quot;&gt;&lt;/script&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.css&quot;/&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css&quot;/&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap-glyphicons.css&quot;/&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.0/css/all.min.css&quot;/&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css&quot;/&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/python-visualization/folium/folium/templates/leaflet.awesome.rotate.min.css&quot;/&gt;\n    \n            &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,\n                initial-scale=1.0, maximum-scale=1.0, user-scalable=no&quot; /&gt;\n            &lt;style&gt;\n                #map_234626ada7ce036237055b4572f81929 {\n                    position: relative;\n                    width: 100.0%;\n                    height: 100.0%;\n                    left: 0.0%;\n                    top: 0.0%;\n                }\n                .leaflet-container { font-size: 1rem; }\n            &lt;/style&gt;\n\n            &lt;style&gt;html, body {\n                width: 100%;\n                height: 100%;\n                margin: 0;\n                padding: 0;\n            }\n            &lt;/style&gt;\n\n            &lt;style&gt;#map {\n                position:absolute;\n                top:0;\n                bottom:0;\n                right:0;\n                left:0;\n                }\n            &lt;/style&gt;\n\n            &lt;script&gt;\n                L_NO_TOUCH = false;\n                L_DISABLE_3D = false;\n            &lt;/script&gt;\n\n        \n&lt;/head&gt;\n&lt;body&gt;\n    \n    \n            &lt;div class=&quot;folium-map&quot; id=&quot;map_234626ada7ce036237055b4572f81929&quot; &gt;&lt;/div&gt;\n        \n&lt;/body&gt;\n&lt;script&gt;\n    \n    \n            var map_234626ada7ce036237055b4572f81929 = L.map(\n                &quot;map_234626ada7ce036237055b4572f81929&quot;,\n                {\n                    center: [-23.511052, -46.705493],\n                    crs: L.CRS.EPSG3857,\n                    ...{\n  &quot;zoom&quot;: 13,\n  &quot;zoomControl&quot;: true,\n  &quot;preferCanvas&quot;: false,\n}\n\n                }\n            );\n\n            \n\n        \n    \n            var tile_layer_7d45777bffc380b464b9a18f496159ad = L.tileLayer(\n                &quot;https://tile.openstreetmap.org/{z}/{x}/{y}.png&quot;,\n                {\n  &quot;minZoom&quot;: 0,\n  &quot;maxZoom&quot;: 19,\n  &quot;maxNativeZoom&quot;: 19,\n  &quot;noWrap&quot;: false,\n  &quot;attribution&quot;: &quot;\\u0026copy; \\u003ca href=\\&quot;https://www.openstreetmap.org/copyright\\&quot;\\u003eOpenStreetMap\\u003c/a\\u003e contributors&quot;,\n  &quot;subdomains&quot;: &quot;abc&quot;,\n  &quot;detectRetina&quot;: false,\n  &quot;tms&quot;: false,\n  &quot;opacity&quot;: 1,\n}\n\n            );\n        \n    \n            tile_layer_7d45777bffc380b464b9a18f496159ad.addTo(map_234626ada7ce036237055b4572f81929);\n        \n    \n            var marker_e973efcaaf4c0f5c0639463915ff55e4 = L.marker(\n                [-23.511052, -46.705493],\n                {\n}\n            ).addTo(map_234626ada7ce036237055b4572f81929);\n        \n    \n            var icon_51358c31f41269c493f33a5ac116699f = L.AwesomeMarkers.icon(\n                {\n  &quot;markerColor&quot;: &quot;blue&quot;,\n  &quot;iconColor&quot;: &quot;white&quot;,\n  &quot;icon&quot;: &quot;info-sign&quot;,\n  &quot;prefix&quot;: &quot;glyphicon&quot;,\n  &quot;extraClasses&quot;: &quot;fa-rotate-0&quot;,\n}\n            );\n        \n    \n        var popup_4d5893951bfb49a5e3b106e4bc06c3d7 = L.popup({\n  &quot;maxWidth&quot;: &quot;100%&quot;,\n});\n\n        \n            \n                var html_0eac3caa9aded8d505a6f2a855722f0a = $(`&lt;div id=&quot;html_0eac3caa9aded8d505a6f2a855722f0a&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;Parada: MARGINAL B/C&lt;/div&gt;`)[0];\n                popup_4d5893951bfb49a5e3b106e4bc06c3d7.setContent(html_0eac3caa9aded8d505a6f2a855722f0a);\n            \n        \n\n        marker_e973efcaaf4c0f5c0639463915ff55e4.bindPopup(popup_4d5893951bfb49a5e3b106e4bc06c3d7)\n        ;\n\n        \n    \n    \n                marker_e973efcaaf4c0f5c0639463915ff55e4.setIcon(icon_51358c31f41269c493f33a5ac116699f);\n            \n    \n            var marker_e73ee63ed0ea9300a0221b5d389f6bb4 = L.marker(\n                [-23.514036, -46.702259],\n                {\n}\n            ).addTo(map_234626ada7ce036237055b4572f81929);\n        \n    \n            var icon_ffce0eaa2777d42ce0336862e42099bb = L.AwesomeMarkers.icon(\n                {\n  &quot;markerColor&quot;: &quot;blue&quot;,\n  &quot;iconColor&quot;: &quot;white&quot;,\n  &quot;icon&quot;: &quot;info-sign&quot;,\n  &quot;prefix&quot;: &quot;glyphicon&quot;,\n  &quot;extraClasses&quot;: &quot;fa-rotate-0&quot;,\n}\n            );\n        \n    \n        var popup_d1f540e5b883356ffde463abb720016f = L.popup({\n  &quot;maxWidth&quot;: &quot;100%&quot;,\n});\n\n        \n            \n                var html_bf8cb6605ff34adcb8c765ddcc349bef = $(`&lt;div id=&quot;html_bf8cb6605ff34adcb8c765ddcc349bef&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;Parada: JOSE MARIA B/C&lt;/div&gt;`)[0];\n                popup_d1f540e5b883356ffde463abb720016f.setContent(html_bf8cb6605ff34adcb8c765ddcc349bef);\n            \n        \n\n        marker_e73ee63ed0ea9300a0221b5d389f6bb4.bindPopup(popup_d1f540e5b883356ffde463abb720016f)\n        ;\n\n        \n    \n    \n                marker_e73ee63ed0ea9300a0221b5d389f6bb4.setIcon(icon_ffce0eaa2777d42ce0336862e42099bb);\n            \n    \n            var marker_b6d334562e9e91e59adbc47ebaba7138 = L.marker(\n                [-23.516592, -46.698575],\n                {\n}\n            ).addTo(map_234626ada7ce036237055b4572f81929);\n        \n    \n            var icon_9f074ec8104f5951bee0afe066f52d4c = L.AwesomeMarkers.icon(\n                {\n  &quot;markerColor&quot;: &quot;blue&quot;,\n  &quot;iconColor&quot;: &quot;white&quot;,\n  &quot;icon&quot;: &quot;info-sign&quot;,\n  &quot;prefix&quot;: &quot;glyphicon&quot;,\n  &quot;extraClasses&quot;: &quot;fa-rotate-0&quot;,\n}\n            );\n        \n    \n        var popup_160f1a8745e58fcaf60237f2d12efbba = L.popup({\n  &quot;maxWidth&quot;: &quot;100%&quot;,\n});\n\n        \n            \n                var html_d429502f23474ee426eaf4d6c5ccf032 = $(`&lt;div id=&quot;html_d429502f23474ee426eaf4d6c5ccf032&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;Parada: ZANELLA B/C&lt;/div&gt;`)[0];\n                popup_160f1a8745e58fcaf60237f2d12efbba.setContent(html_d429502f23474ee426eaf4d6c5ccf032);\n            \n        \n\n        marker_b6d334562e9e91e59adbc47ebaba7138.bindPopup(popup_160f1a8745e58fcaf60237f2d12efbba)\n        ;\n\n        \n    \n    \n                marker_b6d334562e9e91e59adbc47ebaba7138.setIcon(icon_9f074ec8104f5951bee0afe066f52d4c);\n            \n    \n            var marker_35812be1c80679ced7cce7111734f582 = L.marker(\n                [-23.48455, -46.723093],\n                {\n}\n            ).addTo(map_234626ada7ce036237055b4572f81929);\n        \n    \n            var icon_580f0443d4acb80fbabdc5a5fe51031d = L.AwesomeMarkers.icon(\n                {\n  &quot;markerColor&quot;: &quot;blue&quot;,\n  &quot;iconColor&quot;: &quot;white&quot;,\n  &quot;icon&quot;: &quot;info-sign&quot;,\n  &quot;prefix&quot;: &quot;glyphicon&quot;,\n  &quot;extraClasses&quot;: &quot;fa-rotate-0&quot;,\n}\n            );\n        \n    \n        var popup_7305daf470df482f4a315a5ec442e867 = L.popup({\n  &quot;maxWidth&quot;: &quot;100%&quot;,\n});\n\n        \n            \n                var html_769c02b55e06c1b5bc63fa4035eb5537 = $(`&lt;div id=&quot;html_769c02b55e06c1b5bc63fa4035eb5537&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;Parada: GUERINO C/B&lt;/div&gt;`)[0];\n                popup_7305daf470df482f4a315a5ec442e867.setContent(html_769c02b55e06c1b5bc63fa4035eb5537);\n            \n        \n\n        marker_35812be1c80679ced7cce7111734f582.bindPopup(popup_7305daf470df482f4a315a5ec442e867)\n        ;\n\n        \n    \n    \n                marker_35812be1c80679ced7cce7111734f582.setIcon(icon_580f0443d4acb80fbabdc5a5fe51031d);\n            \n    \n            var marker_bec3c1bd56189a46db380280ee8d1682 = L.marker(\n                [-23.484536, -46.722711],\n                {\n}\n            ).addTo(map_234626ada7ce036237055b4572f81929);\n        \n    \n            var icon_64220b3f194f482bfc8b162f19df031a = L.AwesomeMarkers.icon(\n                {\n  &quot;markerColor&quot;: &quot;blue&quot;,\n  &quot;iconColor&quot;: &quot;white&quot;,\n  &quot;icon&quot;: &quot;info-sign&quot;,\n  &quot;prefix&quot;: &quot;glyphicon&quot;,\n  &quot;extraClasses&quot;: &quot;fa-rotate-0&quot;,\n}\n            );\n        \n    \n        var popup_f5a94b5d25eef177ef54f28d5fc05398 = L.popup({\n  &quot;maxWidth&quot;: &quot;100%&quot;,\n});\n\n        \n            \n                var html_36a4cededb51adeda7a0b668e2ea1776 = $(`&lt;div id=&quot;html_36a4cededb51adeda7a0b668e2ea1776&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;Parada: GUERINO B/C&lt;/div&gt;`)[0];\n                popup_f5a94b5d25eef177ef54f28d5fc05398.setContent(html_36a4cededb51adeda7a0b668e2ea1776);\n            \n        \n\n        marker_bec3c1bd56189a46db380280ee8d1682.bindPopup(popup_f5a94b5d25eef177ef54f28d5fc05398)\n        ;\n\n        \n    \n    \n                marker_bec3c1bd56189a46db380280ee8d1682.setIcon(icon_64220b3f194f482bfc8b162f19df031a);\n            \n    \n            var marker_a6812081ed54e8e5e29fc19999a258be = L.marker(\n                [-23.486106499999998, -46.726086499999994],\n                {\n}\n            ).addTo(map_234626ada7ce036237055b4572f81929);\n        \n    \n            var icon_ae0713ad31ad9bd6b580716ed7bc019e = L.AwesomeMarkers.icon(\n                {\n  &quot;markerColor&quot;: &quot;red&quot;,\n  &quot;iconColor&quot;: &quot;white&quot;,\n  &quot;icon&quot;: &quot;bus&quot;,\n  &quot;prefix&quot;: &quot;fa&quot;,\n  &quot;extraClasses&quot;: &quot;fa-rotate-0&quot;,\n}\n            );\n        \n    \n        var popup_dc48e7172d119a3998325d6d16353f51 = L.popup({\n  &quot;maxWidth&quot;: &quot;100%&quot;,\n});\n\n        \n            \n                var html_0a7e67b2c0767d543553d23530148f5d = $(`&lt;div id=&quot;html_0a7e67b2c0767d543553d23530148f5d&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;Prefixo: 11722&lt;/div&gt;`)[0];\n                popup_dc48e7172d119a3998325d6d16353f51.setContent(html_0a7e67b2c0767d543553d23530148f5d);\n            \n        \n\n        marker_a6812081ed54e8e5e29fc19999a258be.bindPopup(popup_dc48e7172d119a3998325d6d16353f51)\n        ;\n\n        \n    \n    \n                marker_a6812081ed54e8e5e29fc19999a258be.setIcon(icon_ae0713ad31ad9bd6b580716ed7bc019e);\n            \n&lt;/script&gt;\n&lt;/html&gt;\" style=\"position:absolute;width:100%;height:100%;left:0;top:0;border:none !important;\" allowfullscreen webkitallowfullscreen mozallowfullscreen></iframe></div></div>\n```\n:::\n:::\n\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdn.jsdelivr.net/npm/requirejs@2.3.6/require.min.js\" integrity=\"sha384-c9c+LnTbwQ3aujuU7ULEPVvgLs+Fn6fJUvIGTsuu1ZcCf11fiEubah0ttpca4ntM sha384-6V1/AdqZRWk1KAlWbKBlGhN7VG4iE/yAZcO6NZPMF8od0vukrvr0tg4qY6NSrItx\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js\" integrity=\"sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2\" crossorigin=\"anonymous\" data-relocate-top=\"true\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}