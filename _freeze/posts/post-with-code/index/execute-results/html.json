{
  "hash": "e9acc92f7c23acd1492cb853ad7808dd",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"API dos correios\"\nauthor: \"Eduardo Nicolau Martins\"\ndate: \"2025-11-23\"\ncategories: [api, code, python, cotação]\nimage: \"grafico.png\"\njupyter: python3\n---\n\nNeste post, vamos explorar um script em Python criado para consultar a cotação diária do dólar (PTAX) diretamente da API do Banco Central do Brasil e gerar automaticamente um gráfico interativo para qualquer mês desejado.\n\nBibliotecas utilizadas\n\n```\nimport pandas as pd\nimport requests\nimport plotly.express as px\nimport calendar\nfrom datetime import datetime\nimport os\n```\n\nO usuário informa o período no formato MMYYYY (por exemplo, “042017”).\nO código converte essa string em uma data válida com datetime.strptime()\n\nEssas datas são então formatadas no padrão MM-DD-YYYY, conforme exigido pela API do Banco Central.\n\n```\ndef gerar_grafico_dolar(periodo_mmyyyy):\n    try:\n        first_date = datetime.strptime(periodo_mmyyyy, \"%m%Y\")\n    except ValueError:\n        print(\"Formato inválido.\")\n        return\n\n    last_day = calendar.monthrange(first_date.year, first_date.month)[1]\n    last_date = first_date.replace(day=last_day)\n    \n    start_str = first_date.strftime(\"%m-%d-%Y\")\n    end_str = last_date.strftime(\"%m-%d-%Y\")\n\n```\n\nProcessamento dos dados com Pandas\n\n```\n    \n    base_url = \"https://olinda.bcb.gov.br/olinda/servico/PTAX/versao/v1/odata/CotacaoDolarPeriodo(dataInicial=@dataInicial,dataFinalCotacao=@dataFinalCotacao)\"\n    url = f\"{base_url}?@dataInicial='{start_str}'&@dataFinalCotacao='{end_str}'&$top=1000&$format=json\"\n    \n    \n    response = requests.get(url)\n    data_json = response.json()\n    \n    if not data_json['value']:\n        print(\"Nenhum dado retornado pela API.\")\n        return\n\n    df = pd.DataFrame(data_json['value'])\n    df = df[['dataHoraCotacao', 'cotacaoVenda']]\n    df['dataHoraCotacao'] = pd.to_datetime(df['dataHoraCotacao']).dt.normalize()\n    df = df.set_index('dataHoraCotacao')\n\n    idx_completo = pd.date_range(start=first_date, end=last_date)\n    df = df.reindex(idx_completo)\n\n    df['cotacaoVenda'] = df['cotacaoVenda'].ffill()\n    df['cotacaoVenda'] = df['cotacaoVenda'].bfill()\n```\n\nGeração do gráfico interativo com Plotly\n\n```\nif not data_json['value']:\n        print(\"Nenhum dado retornado pela API.\")\n        return\n\n    df = pd.DataFrame(data_json['value'])\n    df = df[['dataHoraCotacao', 'cotacaoVenda']]\n    df['dataHoraCotacao'] = pd.to_datetime(df['dataHoraCotacao']).dt.normalize()\n    df = df.set_index('dataHoraCotacao')\n\n    idx_completo = pd.date_range(start=first_date, end=last_date)\n    df = df.reindex(idx_completo)\n\n    df['cotacaoVenda'] = df['cotacaoVenda'].ffill()\n    df['cotacaoVenda'] = df['cotacaoVenda'].bfill()\n\n    df = df.reset_index()\n    df.columns = ['Data', 'Cotação (R$)']\n\n    fig = px.line(\n        df,\n        x='Data',\n        y='Cotação (R$)',\n        title=f'Cotação do Dólar (Venda) - {first_date.strftime(\"%m/%Y\")}',\n        markers=True\n    )\n    \n```\n\nPor fim a geração de imagem e site\n\n```\n    \n    nome_arquivo = f\"grafico_dolar_{periodo_mmyyyy}.html\"\n    fig.write_html(nome_arquivo)\n\n    try:\n        os.startfile(nome_arquivo)\n    except:\n        pass\n\ngerar_grafico_dolar(\"042017\")\n```\n\nCódigo completo\n\n::: {#b56346f3 .cell execution_count=1}\n``` {.python .cell-code}\nimport pandas as pd\nimport requests\nimport plotly.express as px\nimport calendar\nfrom datetime import datetime\nimport os\n\ndef gerar_grafico_dolar(periodo_mmyyyy):\n    try:\n        first_date = datetime.strptime(periodo_mmyyyy, \"%m%Y\")\n    except ValueError:\n        print(\"Formato inválido.\")\n        return\n\n    last_day = calendar.monthrange(first_date.year, first_date.month)[1]\n    last_date = first_date.replace(day=last_day)\n    \n    start_str = first_date.strftime(\"%m-%d-%Y\")\n    end_str = last_date.strftime(\"%m-%d-%Y\")\n\n    base_url = \"https://olinda.bcb.gov.br/olinda/servico/PTAX/versao/v1/odata/CotacaoDolarPeriodo(dataInicial=@dataInicial,dataFinalCotacao=@dataFinalCotacao)\"\n    url = f\"{base_url}?@dataInicial='{start_str}'&@dataFinalCotacao='{end_str}'&$top=1000&$format=json\"\n    \n    response = requests.get(url)\n    data_json = response.json()\n    \n    if not data_json['value']:\n        print(\"Nenhum dado retornado pela API.\")\n        return\n\n    df = pd.DataFrame(data_json['value'])\n    df = df[['dataHoraCotacao', 'cotacaoVenda']]\n    df['dataHoraCotacao'] = pd.to_datetime(df['dataHoraCotacao']).dt.normalize()\n    df = df.set_index('dataHoraCotacao')\n\n    idx_completo = pd.date_range(start=first_date, end=last_date)\n    df = df.reindex(idx_completo)\n\n    df['cotacaoVenda'] = df['cotacaoVenda'].ffill()\n    df['cotacaoVenda'] = df['cotacaoVenda'].bfill()\n\n    df = df.reset_index()\n    df.columns = ['Data', 'Cotação (R$)']\n\n    fig = px.line(\n        df,\n        x='Data',\n        y='Cotação (R$)',\n        title=f'Cotação do Dólar (Venda) - {first_date.strftime(\"%m/%Y\")}',\n        markers=True\n    )\n    \n    nome_arquivo = f\"grafico_dolar_{periodo_mmyyyy}.html\"\n    fig.write_html(nome_arquivo)\n\n    try:\n        os.startfile(nome_arquivo)\n    except:\n        pass\n\ngerar_grafico_dolar(\"042017\")\n```\n:::\n\n\n![resultado](grafico.png)\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [],
    "includes": {}
  }
}